<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
  <head>
    <meta http-equiv="Content-Type" , content="text/html; charset=UTF-8" />
    <link th:href="@{/css/show-allproduct.css}" rel="stylesheet" />
    <title>All Products Page</title>
  </head>
  <header>
    <span class="title y-middle x-start">Adding Page</span>
    <div id="buttons" class="x-end y-middle">
      <form>
        <button class="delete-buttons" onclick="loadMainPage(event)">
          뒤로 가기
        </button>
      </form>
    </div>
  </header>
  <body>
    <table id="products" class="x-middle">
      <caption class="title">
        Product List
      </caption>
      <colgroup>
        <col />
        <col />
        <col />
        <col />
      </colgroup>
      <thead>
        <tr>
          <th>Name</th>
          <th>Price</th>
          <th>Image</th>
          <th>Control</th>
        </tr>
      </thead>
      <tbody>
        <tr th:id="'product'+${product.id}" th:each="product : ${products}">
          <td th:text="${product.name}">Name</td>
          <td th:text="${product.price}">Price</td>
          <td th:text="${product.imageUrl}">Image</td>
          <td>
            <div class="buttons">
              <form>
                <button
                  type="button"
                  class="normal-buttons"
                  th:onclick="|addWishProduct(event, ${product.id})|"
                >
                  제품 담기
                </button>
              </form>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <script th:inline="javascript">
      function loadMainPage(event) {
        event.preventDefault();

        fetch('/user/main', {
          method: 'get',
          headers: {
            Authorization: /*[[${token}]]*/ '',
          },
        })
          .then((response) => response.text())
          .then((html) => {
            document.open();
            document.write(html);
            document.close();
          })
          .catch((error) => console.error('Error:', error));
      }

      function addWishProduct(event, id) {
        event.preventDefault();
        var product = document.getElementById('product' + id);
        var name = product.getElementsByTagName('td')[0].textContent;
        var price = product.getElementsByTagName('td')[1].textContent;
        var imageUrl = product.getElementsByTagName('td')[2].textContent;

        fetch('/api/wishlist/addition', {
          method: 'post',
          headers: {
            'Content-Type': 'application/json',
            Authorization: /*[[${token}]]*/ '',
          },
          body: JSON.stringify({
            id: id,
            name: name,
            price: price,
            imageUrl: imageUrl,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.response) {
              alert(data.response);
            } else {
              alert('알 수 없는 에러가 발생했습니다.');
            }
          })
          .catch((error) => console.error('Error:', error));
      }
    </script>
  </body>
</html>
